# Процессы, потоки

## Процессы
`Процессы` — это экземпляр выполняющейся программы. Каждый процесс имеет свое собственное независимое адресное пространство в памяти, ресурсы (например, открытые файлы, сокеты, дескрипторы), и контекст выполнения

• Характеристики:
  * `Изолированность`: Процессы не могут напрямую обращаться к памяти друг друга (за исключением специально организованных механизмов межпроцессного взаимодействия). Это повышает надежность и безопасность системы, так как сбой в одном процессе обычно не влияет на другие.
  * `Тяжеловесность`: Создание и переключение контекста между процессами — довольно ресурсоемкая операция, так как операционной системе нужно выделить отдельное адресное пространство и ресурсы.
  * `Межпроцессное взаимодействие (IPC)`: Процессы могут общаться друг с другом с помощью специальных механизмов, таких как каналы (pipes), сокеты, разделяемая память и очереди сообщений.

## Поток (Thread):

`Поток` — это "нить" выполнения внутри процесса. Один процесс может иметь несколько потоков, которые совместно используют адресное пространство и ресурсы этого процесса.

• Характеристики:
  * `Совместное использование ресурсов`: Потоки одного процесса совместно используют адресное пространство, открытые файлы, сокеты и другие ресурсы процесса. Это позволяет потокам более эффективно взаимодействовать друг с другом.
  * `Легковесность`: Создание и переключение между потоками — гораздо более быстрая и менее ресурсоемкая операция, чем создание и переключение между процессами.
  * `Синхронизация`: Поскольку потоки совместно используют ресурсы, необходимо использовать механизмы синхронизации (например, мьютексы, семафоры, условные переменные) для предотвращения гонок данных и других проблем, связанных с параллельным доступом к общим ресурсам.

# Async

Async работает по принципу `event loop` - это цикл событий, который следит за выполнением задач и переключает выполнение между корутинами. 

## Корутины
Корутины — это потоки исполнения кода, которые организуются внутри системных потоков.

### Чем отличаются от потоков

Поток — составная часть процесса, который выполняется в операционной системе.

Корутина - является более "легковесной" формой параллелизма внутри одного потока.

- Корутины выполняются в рамках одного потока или пула потоков.
- Потоками управляет операционная система.        
Переключением корутин — разработчик с помощью кода.
- Переключение потоков сложно контролировать. Корутины контролируются более гибко.
- Потоки отнимают много ресурсов процессора — ему постоянно приходится переключаться между ними. Корутины не требуют переключения контекста, поэтому код потребляет мало ресурсов.
- Потоки выполняются на аппаратном или системном уровне. Корутины — более высокоуровневое решение. Это значит, что они дальше от системы и аппаратных ресурсов, зато ближе к человеческим понятиям.
- Потоки ускоряют выполнение сложной задачи, но отнимают много ресурсов. Корутины не повышают скорость, но помогают оптимизировать нагрузку.

Когда говорят «написать корутину», обычно подразумевают асинхронную функцию. Корутины можно ставить на паузу, чтобы дать другим функциям немного поработать. В этом заключается принцип асинхронности

### Пример:
```py3
import asyncio

async def count_to_three():
    print("Веду отсчёт. 1")
    await asyncio.sleep(0)
    print("Веду отсчёт. 2")
    await asyncio.sleep(0)
    print("Веду отсчёт. 3")
    await asyncio.sleep(0)
    # await asyncio.sleep(0) — это команда корутине «Дай поработать другим!»

coroutine_counter = count_to_three()
print(coroutine_counter)  # <coroutine object count_to_three at 0x7f5a58486a98>
coroutine_counter.send(None)  # Выведет "Веду отсчёт. 1"
coroutine_counter.send(None)  # Выведет "Веду отсчёт. 2"
coroutine_counter.send(None)  # Выведет "Веду отсчёт. 3"
coroutine_counter.send(None)  # Выбросит ошибку StopIteration

```
### Пример 2
```py3
import asyncio

async def count(limit=3):
    for step in range(1, limit+1):
        print("Веду отсчёт.", step)
        await asyncio.sleep(0)

coroutine = count(5)

while True:
    coroutine.send(None)
```

# Многопоточность

- способность запускать потоки параллельно.

```py3
import time
from threading import Thread

def sleepMe(i):
    print("Поток %i засыпает на 5 секунд.\n" % i)
    time.sleep(5)
    print("Поток %i сейчас проснулся.\n" % i)
for i in range(10):
    th = Thread(target=sleepMe, args=(i, ))
    th.start()
```
![alt text](image.png)